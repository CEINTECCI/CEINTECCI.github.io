---
import Base from "@layouts/Base.astro";
import CategoryIcon from "@components/icons/CategoryIcon.astro";
import { getTaxonomy, getSinglePage, taxonomyFilter } from "@utils/getAllTags";
import { deslugify } from "@utils/slug";

export async function getStaticPaths() {
  const categories = await getTaxonomy("blog", "categories");
  return categories.map((category) => ({
    params: { category: category.slug },
  }));
}

const { category } = Astro.params;
const posts = await getSinglePage("blog");
const filterByCategory = taxonomyFilter(posts, "categories", category);
---

<Base>
  <h1 class="text-3xl font-bold mb-8 capitalize">Categor√≠a: {deslugify(category)}</h1>
  <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {
      filterByCategory?.map((post) => (
        <a href={`/blog/${post.slug}/`} class="block bg-white dark:bg-gray-900 p-4 rounded-lg shadow-lg hover:shadow-xl transition">
          <div class="relative w-full h-48 overflow-hidden rounded-md">
            <img src={post.data.heroImage} alt={post.data.title} class="w-full h-full object-cover" />
          </div>
          <h2 class="mt-3 text-xl font-semibold">{post.data.title}</h2>
          <p class="mt-2 text-gray-600 dark:text-gray-400">{post.data.description}</p>
        </a>
      ))
    }
  </section>
</Base>
